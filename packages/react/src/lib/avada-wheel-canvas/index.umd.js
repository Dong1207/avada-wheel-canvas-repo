(function(x,T){typeof exports=="object"&&typeof module<"u"?T(exports):typeof define=="function"&&define.amd?define(["exports"],T):(x=typeof globalThis<"u"?globalThis:x||self,T(x.AvadaWheelCanvas={}))})(this,function(x){"use strict";Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(a,t){if(this==null)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if(i===0)return!1;var s=t|0,n=Math.max(s>=0?s:i-Math.abs(s),0);function r(h,o){return h===o||typeof h=="number"&&typeof o=="number"&&isNaN(h)&&isNaN(o)}for(;n<i;){if(r(e[n],a))return!0;n++}return!1}}),String.prototype.includes||(String.prototype.includes=function(a,t){return typeof t!="number"&&(t=0),t+a.length>this.length?!1:this.indexOf(a,t)!==-1}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){if(this==null)throw new TypeError('"this" is null or not defined');var t=Object(this),e=t.length>>>0;if(typeof a!="function")throw new TypeError("predicate must be a function");for(var i=arguments[1],s=0;s<e;){var n=t[s];if(a.call(i,n,s,t))return n;s++}}});const T=(a,...t)=>t.some(e=>Object.prototype.toString.call(a).slice(8,-1).toLowerCase()===e),P=(a,t)=>Object.prototype.hasOwnProperty.call(a,t),U=a=>[].filter.call(a,t=>t!==`
`).join(""),at=a=>a===null?0:typeof a=="object"?NaN:typeof a=="number"?a:typeof a=="string"?a[a.length-1]==="%"?Number(a.slice(0,-1))/100:Number(a):NaN,I=a=>{if(typeof a!="string"||(a=a.toLocaleLowerCase().trim(),a==="transparent"))return!1;if(/^rgba/.test(a)){const t=/([^\s,]+)\)$/.exec(a);if(at(t)===0)return!1}return!0},V=(a,t)=>{let e=a.padding?.split(" ").map(o=>t(o))||[0],i=0,s=0,n=0,r=0;switch(e.length){case 1:i=s=n=r=e[0];break;case 2:i=s=e[0],n=r=e[1];break;case 3:i=e[0],n=r=e[1],s=e[2];break;default:i=e[0],s=e[1],n=e[2],r=e[3]}const h={paddingTop:i,paddingBottom:s,paddingLeft:n,paddingRight:r};for(let o in h)h[o]=P(a,o)&&T(a[o],"string","number")?t(a[o]):h[o];return[i,s,n,r]},lt=(a,t=300)=>{let e=null;return function(...i){e||(e=setTimeout(()=>{a.apply(this,i),clearTimeout(e),e=null},t))}},tt=a=>{const t=[],e=a.map(s=>Number(s)).reduce((s,n)=>{if(n>0){const r=s+n;return t.push(r),r}else return t.push(NaN),s},0),i=Math.random()*e;return t.findIndex(s=>i<=s)},N=(a,t,e,i=1/0)=>{i<=0&&(i=1/0);let s="";const n=[],r=a.measureText("...").width;for(let h=0;h<t.length;h++){s+=t[h];let o=a.measureText(s).width;const l=e(n);if(i===n.length+1&&(o+=r),l<0)return n;if(o>l&&(n.push(s.slice(0,-1)),s=t[h]),i===n.length)return n[n.length-1]+="...",n}return s&&n.push(s),n.length||n.push(t),n},ct=(a,t)=>{const e={},i=[];for(let s=0;s<a.length;s++)e[s]=a[s];for(let s=0;s<t.length;s++){const n=e[t[s]];n&&(i[s]=n)}return i},dt="avada-wheel-canvas",G="1.0.0";class _{constructor(){this.subs=[]}addSub(t){this.subs.includes(t)||this.subs.push(t)}notify(){this.subs.forEach(t=>{t.update()})}}const gt="__proto__"in{};function et(a,t,e,i){Object.defineProperty(a,t,{value:e,enumerable:!1,writable:!0,configurable:!0})}function ft(a){a+=".";let t=[],e="";for(let i=0;i<a.length;i++){let s=a[i];if(/\[|\./.test(s))t.push(e),e="";else{if(/\W/.test(s))continue;e+=s}}return function(i){return t.reduce((s,n)=>s[n],i)}}function ut(a){const t=e=>{T(e,"array","object")&&Object.keys(e).forEach(i=>{const s=e[i];t(s)})};t(a)}const it=Array.prototype,H=Object.create(it);["push","pop","shift","unshift","sort","splice","reverse"].forEach(a=>{H[a]=function(...t){const e=it[a].apply(this,t),i=this.__luckyOb__;return["push","unshift","splice"].includes(a)&&i.walk(this),i.dep.notify(),e}});class pt{constructor(t){this.dep=new _,et(t,"__luckyOb__",this),Array.isArray(t)&&(gt?t.__proto__=H:Object.getOwnPropertyNames(H).forEach(e=>{et(t,e,H[e])})),this.walk(t)}walk(t){Object.keys(t).forEach(e=>{nt(t,e,t[e])})}}function st(a){if(!a||typeof a!="object")return;let t;return"__luckyOb__"in a?t=a.__luckyOb__:t=new pt(a),t}function nt(a,t,e){const i=new _,s=Object.getOwnPropertyDescriptor(a,t);if(s&&s.configurable===!1)return;const n=s&&s.get,r=s&&s.set;(!n||r)&&arguments.length===2&&(e=a[t]);let h=st(e);Object.defineProperty(a,t,{get:()=>{const o=n?n.call(a):e;return _.target&&(i.addSub(_.target),h&&h.dep.addSub(_.target)),o},set:o=>{o!==e&&(e=o,!(n&&!r)&&(r?r.call(a,o):e=o,h=st(o),i.notify()))}})}let mt=0;class wt{constructor(t,e,i,s={}){this.id=mt++,this.$lucky=t,this.expr=e,this.deep=!!s.deep,typeof e=="function"?this.getter=e:this.getter=ft(e),this.cb=i,this.value=this.get()}get(){_.target=this;const t=this.getter.call(this.$lucky,this.$lucky);return this.deep&&ut(t),_.target=null,t}update(){const t=this.get(),e=this.value;this.value=t,this.cb.call(this.$lucky,t,e)}}class Y{constructor(t,e){this.version=G,this.htmlFontSize=16,this.rAF=function(){},this.boxWidth=0,this.boxHeight=0,typeof t=="string"?t={el:t}:t.nodeType===1&&(t={el:"",divElement:t}),t=t,this.config=t,this.data=e,t.flag||(t.flag="WEB"),t.el&&(t.divElement=document.querySelector(t.el)),t.divElement&&(t.canvasElement=document.createElement("canvas"),t.divElement.appendChild(t.canvasElement)),t.canvasElement&&(t.ctx=t.canvasElement.getContext("2d"),t.canvasElement.setAttribute("package",`${dt}@${G}`),t.canvasElement.addEventListener("click",i=>this.handleClick(i))),this.ctx=t.ctx,this.initWindowFunction(),this.config.ctx||console.error("Unable to get CanvasContext2D"),window&&typeof window.addEventListener=="function"&&window.addEventListener("resize",lt(()=>this.resize(),300)),window&&typeof window.MutationObserver=="function"&&new window.MutationObserver(()=>{this.resize()}).observe(document.documentElement,{attributes:!0})}static{this.version=G}resize(){this.config.beforeResize?.(),this.setHTMLFontSize(),this.setDpr(),this.resetWidthAndHeight(),this.zoomCanvas()}initLucky(){if(this.resize(),!this.boxWidth||!this.boxHeight)return console.error("Unable to get width or height")}handleClick(t){}setHTMLFontSize(){window&&(this.htmlFontSize=+window.getComputedStyle(document.documentElement).fontSize.slice(0,-2))}clearCanvas(){const[t,e]=[this.boxWidth,this.boxHeight];this.ctx.clearRect(-t,-e,t*2,e*2)}setDpr(){const{config:t}=this;t.dpr||(window?window.dpr=t.dpr=window.devicePixelRatio||1:t.dpr||console.error(t,"No dpr provided may cause rendering issues"))}resetWidthAndHeight(){const{config:t,data:e}=this;let i=0,s=0;t.divElement&&(i=t.divElement.offsetWidth,s=t.divElement.offsetHeight),this.boxWidth=this.getLength(e.width||t.width)||i,this.boxHeight=this.getLength(e.height||t.height)||s,t.divElement&&(t.divElement.style.overflow="hidden",t.divElement.style.width=this.boxWidth+"px",t.divElement.style.height=this.boxHeight+"px")}zoomCanvas(){const{config:t,ctx:e}=this,{canvasElement:i,dpr:s}=t,[n,r]=[this.boxWidth*s,this.boxHeight*s];i&&(i.width=n,i.height=r,i.style.width=`${n}px`,i.style.height=`${r}px`,i.style["transform-origin"]="left top",i.style.transform=`scale(${1/s})`,e.scale(s,s))}initWindowFunction(){const{config:t}=this;if(window){this.rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},t.setTimeout=window.setTimeout,t.setInterval=window.setInterval,t.clearTimeout=window.clearTimeout,t.clearInterval=window.clearInterval;return}if(t.rAF)this.rAF=t.rAF;else if(t.setTimeout){const e=t.setTimeout;this.rAF=i=>e(i,16.7)}else this.rAF=e=>setTimeout(e,16.7)}isWeb(){return["WEB","UNI-H5","TARO-H5"].includes(this.config.flag)}loadImg(t,e,i="$resolve"){return new Promise((s,n)=>{if(t||n(`=> '${e.src}' cannot be empty or invalid`),this.config.flag==="WEB"){let r=new Image;r.crossorigin="anonymous",r.onload=()=>s(r),r.onerror=()=>n(`=> '${e.src}' image load failed`),r.src=t}else{e[i]=s,e.$reject=n;return}})}drawImage(t,e,...i){let s;const{flag:n,dpr:r}=this.config;if(["WEB","MP-WX"].includes(n))s=e;else if(["UNI-H5","UNI-MP","TARO-H5","TARO-MP"].includes(n))s=e.path;else return console.error("Unexpected flag, platform not yet compatible!");const h=(s.canvas||s).getContext?.("2d");if(h&&!this.isWeb()){i=i.map(l=>l*r);const o=h.getImageData(...i.slice(0,4));t.putImageData(o,...i.slice(4,6))}else{i.length===8&&(i=i.map((o,l)=>l<4?o*r:o));try{t.drawImage(s,...i)}catch{}}}computedWidthAndHeight(t,e,i,s){if(!e.width&&!e.height)return[t.width,t.height];if(e.width&&!e.height){let n=this.getLength(e.width,i);return[n,t.height*(n/t.width)]}else if(!e.width&&e.height){let n=this.getLength(e.height,s);return[t.width*(n/t.height),n]}return[this.getLength(e.width,i),this.getLength(e.height,s)]}changeUnits(t,e=1){const{config:i}=this;return Number(t.replace(/^([-]*[0-9.]*)([a-z%]*)$/,(s,n,r)=>{const h={"%":l=>l*(e/100),px:l=>l*1,rem:l=>l*this.htmlFontSize,vw:l=>l/100*window.innerWidth}[r];if(h)return h(n);const o=i.handleCssUnit||i.unitFunc;return o?o(n,r):n}))}getLength(t,e){return T(t,"number")?t:T(t,"string")?this.changeUnits(t,e):0}getOffsetX(t,e=0){return(e-t)/2}getOffscreenCanvas(t,e){if(!P(this,"_offscreenCanvas")&&(window&&window.document&&this.config.flag==="WEB"?this._offscreenCanvas=document.createElement("canvas"):this._offscreenCanvas=this.config.offscreenCanvas,!this._offscreenCanvas))return console.error("Offscreen Canvas cannot render!");const i=this.config.dpr,s=this._offscreenCanvas;s.width=(t||300)*i,s.height=(e||150)*i;const n=s.getContext("2d");return n.clearRect(0,0,t,e),n.scale(i,i),n.dpr=i,{_offscreenCanvas:s,_ctx:n}}$set(t,e,i){!t||typeof t!="object"||nt(t,e,i)}$computed(t,e,i){Object.defineProperty(t,e,{get:()=>i.call(this)})}$watch(t,e,i={}){typeof e=="object"&&(i=e,e=i.handler);const s=new wt(this,t,e,i);return i.immediate&&e.call(this,s.value),function(){}}}const E=a=>Math.PI/180*a,bt=(a,t)=>[+(Math.cos(a)*t).toFixed(8),+(Math.sin(a)*t).toFixed(8)],St=(a,t,e,i,s,n)=>{a.beginPath();let r=E(90/Math.PI/e*n),h=i+r,o=s-r;a.arc(0,0,e,h,o,!1),a.lineTo(...bt((i+s)/2,n/2/Math.abs(Math.sin((i-s)/2)))),a.closePath()},R=(a,...[t,e,i,s,n])=>{const r=Math.min(i,s),h=Math.PI;n>r/2&&(n=r/2),a.beginPath(),a.moveTo(t+n,e),a.lineTo(t+n,e),a.lineTo(t+i-n,e),a.arc(t+i-n,e+n,n,-h/2,0),a.lineTo(t+i,e+s-n),a.arc(t+i-n,e+s-n,n,0,h/2),a.lineTo(t+n,e+s),a.arc(t+n,e+s-n,n,h/2,h),a.lineTo(t,e+n),a.arc(t+n,e+n,n,h,-h/2),a.closePath()},yt=(a,t,e,i,s,n)=>{const r=/linear-gradient\((.+)\)/.exec(n)[1].split(",").map(c=>c.trim());let h=r.shift(),o=[0,0,0,0];if(h.includes("deg")){h=h.slice(0,-3)%360;const c=d=>Math.tan(d/180*Math.PI);h>=0&&h<45?o=[t,e+s,t+i,e+s-i*c(h-0)]:h>=45&&h<90?o=[t,e+s,t+i-s*c(h-45),e]:h>=90&&h<135?o=[t+i,e+s,t+i-s*c(h-90),e]:h>=135&&h<180?o=[t+i,e+s,t,e+i*c(h-135)]:h>=180&&h<225?o=[t+i,e,t,e+i*c(h-180)]:h>=225&&h<270?o=[t+i,e,t+s*c(h-225),e+s]:h>=270&&h<315?o=[t,e,t+s*c(h-270),e+s]:h>=315&&h<360&&(o=[t,e,t+i,e+s-i*c(h-315)])}else h.includes("top")?o=[t,e+s,t,e]:h.includes("bottom")?o=[t,e,t,e+s]:h.includes("left")?o=[t+i,e,t,e]:h.includes("right")&&(o=[t,e,t+i,e]);const l=a.createLinearGradient(...o.map(c=>c>>0));return r.reduce((c,d,g)=>{const p=d.split(" ");return p.length===1?c.addColorStop(g,p[0]):p.length===2&&c.addColorStop(...p),c},l)},O={easeIn:function(a,t,e,i){return a>=i&&(a=i),e*(a/=i)*a+t},easeOut:function(a,t,e,i){return a>=i&&(a=i),-e*(a/=i)*(a-2)+t}};class Ct extends Y{constructor(t,e){super(t,{width:e.width,height:e.height}),this.blocks=[],this.prizes=[],this.buttons=[],this.defaultConfig={},this.defaultStyle={},this._defaultConfig={},this._defaultStyle={},this.Radius=0,this.prizeRadius=0,this.prizeDeg=0,this.prizeAng=0,this.rotateDeg=0,this.maxBtnRadius=0,this.startTime=0,this.endTime=0,this.stopDeg=0,this.endDeg=0,this.FPS=16.6,this.step=0,this.ImageCache=new Map,this.initData(e),this.initWatch(),this.initComputed(),t.beforeCreate?.call(this),this.init()}resize(){super.resize(),this.Radius=Math.min(this.boxWidth,this.boxHeight)/2,this.ctx.translate(this.Radius,this.Radius),this.draw(),this.config.afterResize?.()}initLucky(){this.Radius=0,this.prizeRadius=0,this.prizeDeg=0,this.prizeAng=0,this.rotateDeg=0,this.maxBtnRadius=0,this.startTime=0,this.endTime=0,this.stopDeg=0,this.endDeg=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,super.initLucky()}initData(t){this.$set(this,"width",t.width),this.$set(this,"height",t.height),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)}initComputed(){this.$computed(this,"_defaultConfig",()=>({gutter:"0px",offsetDegree:0,speed:20,speedFunction:"quad",accelerationTime:2500,decelerationTime:2500,stopRange:0,...this.defaultConfig})),this.$computed(this,"_defaultStyle",()=>({fontSize:"18px",fontColor:"#000",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%",...this.defaultStyle}))}initWatch(){this.$watch("width",t=>{this.data.width=t,this.resize()}),this.$watch("height",t=>{this.data.height=t,this.resize()}),this.$watch("blocks",t=>{this.initImageCache()},{deep:!0}),this.$watch("prizes",t=>{this.initImageCache()},{deep:!0}),this.$watch("buttons",t=>{this.initImageCache()},{deep:!0}),this.$watch("defaultConfig",()=>this.draw(),{deep:!0}),this.$watch("defaultStyle",()=>this.draw(),{deep:!0}),this.$watch("startCallback",()=>this.init()),this.$watch("endCallback",()=>this.init())}async init(){this.initLucky();const{config:t}=this;t.beforeInit?.call(this),this.draw(),this.draw(),await this.initImageCache(),t.afterInit?.call(this)}initImageCache(){return new Promise(t=>{const e={blocks:this.blocks.map(i=>i.imgs),prizes:this.prizes.map(i=>i.imgs),buttons:this.buttons.map(i=>i.imgs)};Object.keys(e).forEach(i=>{const s=e[i],n=[];s&&s.forEach((r,h)=>{r&&r.forEach((o,l)=>{n.push(this.loadAndCacheImg(i,h,l))})}),Promise.all(n).then(()=>{this.draw(),t()})})})}handleClick(t){const{ctx:e}=this;e.beginPath(),e.arc(0,0,this.maxBtnRadius,0,Math.PI*2,!1),e.isPointInPath(t.offsetX,t.offsetY)&&this.step===0&&this.startCallback?.(t)}async loadAndCacheImg(t,e,i){return new Promise((s,n)=>{const r=this[t][e];if(!r||!r.imgs)return;const h=r.imgs[i];h&&this.loadImg(h.src,h).then(async o=>{typeof h.formatter=="function"&&(o=await Promise.resolve(h.formatter.call(this,o))),this.ImageCache.set(h.src,o),s()}).catch(o=>{console.error(`${t}[${e}].imgs[${i}] ${o}`),n()})})}drawBlock(t,e,i){const{ctx:s}=this;I(e.background)&&(s.beginPath(),s.fillStyle=e.background,s.arc(0,0,t,0,Math.PI*2,!1),s.fill()),e.imgs&&e.imgs.forEach((n,r)=>{const h=this.ImageCache.get(n.src);if(!h)return;const[o,l]=this.computedWidthAndHeight(h,n,t*2,t*2),[c,d]=[this.getOffsetX(o)+this.getLength(n.left,t*2),this.getLength(n.top,t*2)-t];s.save(),n.rotate&&s.rotate(E(this.rotateDeg)),this.drawImage(s,h,c,d,o,l),s.restore()})}draw(){const{config:t,ctx:e,_defaultConfig:i,_defaultStyle:s}=this;t.beforeDraw?.call(this,e),e.clearRect(-this.Radius,-this.Radius,this.Radius*2,this.Radius*2),this.prizeRadius=this.blocks.reduce((l,c,d)=>(this.drawBlock(l,c,d),l-this.getLength(c.padding&&c.padding.split(" ")[0])),this.Radius),this.prizeDeg=360/this.prizes.length,this.prizeAng=E(this.prizeDeg);const n=this.prizeRadius*Math.sin(this.prizeAng/2)*2;let r=E(this.rotateDeg-90+this.prizeDeg/2+i.offsetDegree);const h=(l,c)=>this.getOffsetX(e.measureText(c).width)+this.getLength(l.left,n),o=(l,c,d)=>{const g=l.lineHeight||s.lineHeight||l.fontSize||s.fontSize;return this.getLength(l.top,c)+(d+1)*this.getLength(g)};e.save(),this.prizes.forEach((l,c)=>{let d=r+c*this.prizeAng,g=this.prizeRadius-this.maxBtnRadius;const p=l.background||s.background;I(p)&&(e.fillStyle=p,St(e,this.maxBtnRadius,this.prizeRadius,d-this.prizeAng/2,d+this.prizeAng/2,this.getLength(i.gutter)),e.fill());let f=Math.cos(d)*this.prizeRadius,w=Math.sin(d)*this.prizeRadius;e.translate(f,w),e.rotate(d+E(90)),l.imgs&&l.imgs.forEach((u,b)=>{const m=this.ImageCache.get(u.src);if(!m)return;const[S,y]=this.computedWidthAndHeight(m,u,this.prizeAng*this.prizeRadius,g),[z,v]=[this.getOffsetX(S)+this.getLength(u.left,n),this.getLength(u.top,g)];this.drawImage(e,m,z,v,S,y)}),l.fonts&&l.fonts.forEach(u=>{const b=u.fontColor||s.fontColor,m=u.fontWeight||s.fontWeight,S=this.getLength(u.fontSize||s.fontSize),y=u.fontStyle||s.fontStyle,z=P(u,"wordWrap")?u.wordWrap:s.wordWrap,v=u.lengthLimit||s.lengthLimit,$=u.lineClamp||s.lineClamp,W=u.rotate||0;e.fillStyle=b,e.font=`${m} ${S>>0}px ${y}`;let L=[],A=String(u.text);z?L=N(e,U(A),k=>{let D=(this.prizeRadius-o(u,g,k.length))*Math.tan(this.prizeAng/2)*2-this.getLength(i.gutter);return this.getLength(v,D)},$):L=A.split(`
`),L.filter(k=>!!k).forEach((k,M)=>{const B=h(u,k),D=o(u,g,M);e.save(),e.translate(B,D),e.rotate(E(W)),e.fillText(k,0,0),e.restore()})}),e.rotate(E(360)-d-E(90)),e.translate(-f,-w)}),e.restore(),this.buttons.forEach((l,c)=>{let d=this.getLength(l.radius,this.prizeRadius);this.maxBtnRadius=Math.max(this.maxBtnRadius,d),I(l.background)&&(e.beginPath(),e.fillStyle=l.background,e.arc(0,0,d,0,Math.PI*2,!1),e.fill()),l.pointer&&I(l.background)&&(e.beginPath(),e.fillStyle=l.background,e.moveTo(-d,0),e.lineTo(d,0),e.lineTo(0,-d*2),e.closePath(),e.fill()),l.imgs&&l.imgs.forEach((g,p)=>{const f=this.ImageCache.get(g.src);if(!f)return;const[w,u]=this.computedWidthAndHeight(f,g,d*2,d*2),[b,m]=[this.getOffsetX(w)+this.getLength(g.left,d),this.getLength(g.top,d)];this.drawImage(e,f,b,m,w,u)}),l.fonts&&l.fonts.forEach(g=>{let p=g.fontColor||s.fontColor,f=g.fontWeight||s.fontWeight,w=this.getLength(g.fontSize||s.fontSize),u=g.fontStyle||s.fontStyle;e.fillStyle=p,e.font=`${f} ${w>>0}px ${u}`,String(g.text).split(`
`).forEach((b,m)=>{e.fillText(b,h(g,b),o(g,d,m))})})}),t.afterDraw?.call(this,e)}carveOnGunwaleOfAMovingBoat(){const{_defaultConfig:t,prizeFlag:e,prizeDeg:i,rotateDeg:s}=this;this.endTime=Date.now();const n=this.stopDeg=s,r=t.speed,h=(Math.random()*i-i/2)*this.getLength(t.stopRange);let o=0,l=0,c=0;for(;++o;){const d=360*o-e*i-s-t.offsetDegree+h-i/2;let g=O.easeOut(this.FPS,n,d,t.decelerationTime)-n;if(g>r){this.endDeg=r-l>g-r?d:c;break}c=d,l=g}}play(){this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,this.config.afterStart?.(),this.run())}stop(t){if(!(this.step===0||this.step===3)){if(!t&&t!==0){const e=this.prizes.map(i=>i.range);t=tt(e)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}}run(t=0){const{rAF:e,step:i,prizeFlag:s,_defaultConfig:n}=this,{accelerationTime:r,decelerationTime:h,speed:o}=n;if(i===0){this.endCallback?.(this.prizes.find((g,p)=>p===s)||{});return}if(s===-1)return;i===3&&!this.endDeg&&this.carveOnGunwaleOfAMovingBoat();const l=Date.now()-this.startTime,c=Date.now()-this.endTime;let d=this.rotateDeg;if(i===1||l<r){this.FPS=l/t;const g=O.easeIn(l,0,o,r);g===o&&(this.step=2),d=d+g%360}else i===2?(d=d+o%360,s!==void 0&&s>=0&&(this.step=3,this.stopDeg=0,this.endDeg=0)):i===3?(d=O.easeOut(c,this.stopDeg,this.endDeg,h),c>=h&&(this.step=0)):this.stop(-1);this.rotateDeg=d,this.draw(),e(this.run.bind(this,t+1))}conversionAxis(t,e){const{config:i}=this;return[t/i.dpr-this.Radius,e/i.dpr-this.Radius]}}class zt extends Y{constructor(t,e){super(t,{width:e.width,height:e.height}),this.rows=3,this.cols=3,this.blocks=[],this.prizes=[],this.buttons=[],this.defaultConfig={},this.defaultStyle={},this.activeStyle={},this._defaultConfig={},this._defaultStyle={},this._activeStyle={},this.cellWidth=0,this.cellHeight=0,this.startTime=0,this.endTime=0,this.currIndex=0,this.stopIndex=0,this.endIndex=0,this.demo=!1,this.timer=0,this.FPS=16.6,this.step=0,this.prizeFlag=-1,this.cells=[],this.ImageCache=new Map,this.initData(e),this.initWatch(),this.initComputed(),t.beforeCreate?.call(this),this.init()}resize(){super.resize(),this.draw(),this.config.afterResize?.()}initLucky(){this.cellWidth=0,this.cellHeight=0,this.startTime=0,this.endTime=0,this.currIndex=0,this.stopIndex=0,this.endIndex=0,this.demo=!1,this.timer=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,super.initLucky()}initData(t){this.$set(this,"width",t.width),this.$set(this,"height",t.height),this.$set(this,"rows",Number(t.rows)||3),this.$set(this,"cols",Number(t.cols)||3),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"button",t.button),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"activeStyle",t.activeStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)}initComputed(){this.$computed(this,"_defaultConfig",()=>{const t={gutter:5,speed:20,accelerationTime:2500,decelerationTime:2500,...this.defaultConfig};return t.gutter=this.getLength(t.gutter),t.speed=t.speed/40,t}),this.$computed(this,"_defaultStyle",()=>({borderRadius:20,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",shadow:"",wordWrap:!0,lengthLimit:"90%",...this.defaultStyle})),this.$computed(this,"_activeStyle",()=>({background:"#ffce98",shadow:"",...this.activeStyle}))}initWatch(){this.$watch("width",t=>{this.data.width=t,this.resize()}),this.$watch("height",t=>{this.data.height=t,this.resize()}),this.$watch("blocks",t=>{this.initImageCache()},{deep:!0}),this.$watch("prizes",t=>{this.initImageCache()},{deep:!0}),this.$watch("buttons",t=>{this.initImageCache()},{deep:!0}),this.$watch("rows",()=>this.init()),this.$watch("cols",()=>this.init()),this.$watch("defaultConfig",()=>this.draw(),{deep:!0}),this.$watch("defaultStyle",()=>this.draw(),{deep:!0}),this.$watch("activeStyle",()=>this.draw(),{deep:!0}),this.$watch("startCallback",()=>this.init()),this.$watch("endCallback",()=>this.init())}async init(){this.initLucky();const{config:t}=this;t.beforeInit?.call(this),this.draw(),await this.initImageCache(),t.afterInit?.call(this)}initImageCache(){return new Promise(t=>{const e=this.buttons.map(s=>s.imgs);this.button&&e.push(this.button.imgs);const i={blocks:this.blocks.map(s=>s.imgs),prizes:this.prizes.map(s=>s.imgs),buttons:e};Object.keys(i).forEach(s=>{const n=i[s],r=[];n&&n.forEach((h,o)=>{h&&h.forEach((l,c)=>{r.push(this.loadAndCacheImg(s,o,c))})}),Promise.all(r).then(()=>{this.draw(),t()})})})}handleClick(t){const{ctx:e}=this;[...this.buttons,this.button].forEach(i=>{if(!i)return;const[s,n,r,h]=this.getGeometricProperty([i.x,i.y,i.col||1,i.row||1]);e.beginPath(),e.rect(s,n,r,h),e.isPointInPath(t.offsetX,t.offsetY)&&this.step===0&&(typeof i.callback=="function"&&i.callback.call(this,i),this.startCallback?.(t,i))})}async loadAndCacheImg(t,e,i){return new Promise((s,n)=>{let r=this[t][e];if(t==="buttons"&&!this.buttons.length&&this.button&&(r=this.button),!r||!r.imgs)return;const h=r.imgs[i];if(!h)return;const o=[this.loadImg(h.src,h),h.activeSrc&&this.loadImg(h.activeSrc,h,"$activeResolve")];Promise.all(o).then(async([l,c])=>{const d=h.formatter;typeof d=="function"&&(l=await Promise.resolve(d.call(this,l)),c&&(c=await Promise.resolve(d.call(this,c)))),this.ImageCache.set(h.src,l),c&&this.ImageCache.set(h.activeSrc,c),s()}).catch(l=>{console.error(`${t}[${e}].imgs[${i}] ${l}`),n()})})}draw(){const{config:t,ctx:e,_defaultConfig:i,_defaultStyle:s,_activeStyle:n}=this;t.beforeDraw?.call(this,e),e.clearRect(0,0,this.boxWidth,this.boxHeight),this.cells=[...this.prizes,...this.buttons],this.button&&this.cells.push(this.button),this.cells.forEach(r=>{r.col=r.col||1,r.row=r.row||1}),this.prizeArea=this.blocks.reduce(({x:r,y:h,w:o,h:l},c,d)=>{const[g,p,f,w]=V(c,this.getLength.bind(this)),u=c.borderRadius?this.getLength(c.borderRadius):0,b=c.background;return I(b)&&(e.fillStyle=this.handleBackground(r,h,o,l,b),R(e,r,h,o,l,u),e.fill()),c.imgs&&c.imgs.forEach((m,S)=>{const y=this.ImageCache.get(m.src);if(!y)return;const[z,v]=this.computedWidthAndHeight(y,m,o,l),[$,W]=[this.getOffsetX(z,o)+this.getLength(m.left,o),this.getLength(m.top,l)];this.drawImage(e,y,r+$,h+W,z,v)}),{x:r+f,y:h+g,w:o-f-w,h:l-g-p}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight}),this.cellWidth=(this.prizeArea.w-i.gutter*(this.cols-1))/this.cols,this.cellHeight=(this.prizeArea.h-i.gutter*(this.rows-1))/this.rows,this.cells.forEach((r,h)=>{let[o,l,c,d]=this.getGeometricProperty([r.x,r.y,r.col,r.row]),g=!1;(this.prizeFlag===void 0||this.prizeFlag>-1)&&(g=h===this.currIndex%this.prizes.length>>0);const p=g?n.background:r.background||s.background;if(I(p)){const f=(g?n.shadow:r.shadow||s.shadow).replace(/px/g,"").split(",")[0].split(" ").map((u,b)=>b<3?Number(u):u);f.length===4&&(e.shadowColor=f[3],e.shadowOffsetX=f[0]*t.dpr,e.shadowOffsetY=f[1]*t.dpr,e.shadowBlur=f[2],f[0]>0?c-=f[0]:(c+=f[0],o-=f[0]),f[1]>0?d-=f[1]:(d+=f[1],l-=f[1])),e.fillStyle=this.handleBackground(o,l,c,d,p);const w=this.getLength(r.borderRadius?r.borderRadius:s.borderRadius);R(e,o,l,c,d,w),e.fill(),e.shadowColor="rgba(0, 0, 0, 0)",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0}h>=this.prizes.length&&(h-=this.prizes.length),r.imgs&&r.imgs.forEach((f,w)=>{const u=this.ImageCache.get(f.src),b=this.ImageCache.get(f.activeSrc);if(!u)return;const m=g&&b||u;if(!m)return;const[S,y]=this.computedWidthAndHeight(m,f,c,d),[z,v]=[o+this.getOffsetX(S,c)+this.getLength(f.left,c),l+this.getLength(f.top,d)];this.drawImage(e,m,z,v,S,y)}),r.fonts&&r.fonts.forEach(f=>{const w=g&&n.fontStyle?n.fontStyle:f.fontStyle||s.fontStyle,u=g&&n.fontWeight?n.fontWeight:f.fontWeight||s.fontWeight,b=g&&n.fontSize?this.getLength(n.fontSize):this.getLength(f.fontSize||s.fontSize),m=g&&n.lineHeight?n.lineHeight:f.lineHeight||s.lineHeight||f.fontSize||s.fontSize,S=P(f,"wordWrap")?f.wordWrap:s.wordWrap,y=f.lengthLimit||s.lengthLimit,z=f.lineClamp||s.lineClamp;e.font=`${u} ${b>>0}px ${w}`,e.fillStyle=g&&n.fontColor?n.fontColor:f.fontColor||s.fontColor;let v=[],$=String(f.text);if(S){let W=this.getLength(y,c);v=N(e,U($),()=>W,z)}else v=$.split(`
`);v.forEach((W,L)=>{e.fillText(W,o+this.getOffsetX(e.measureText(W).width,c)+this.getLength(f.left,c),l+this.getLength(f.top,d)+(L+1)*this.getLength(m))})})}),t.afterDraw?.call(this,e)}handleBackground(t,e,i,s,n){const{ctx:r}=this;return n.includes("linear-gradient")&&(n=yt(r,t,e,i,s,n)),n}carveOnGunwaleOfAMovingBoat(){const{_defaultConfig:t,prizeFlag:e,currIndex:i}=this;this.endTime=Date.now();const s=this.stopIndex=i,n=t.speed;let r=0,h=0,o=0;for(;++r;){const l=this.prizes.length*r+e-s,c=O.easeOut(this.FPS,s,l,t.decelerationTime)-s;if(c>n){this.endIndex=n-h>c-n?l:o;break}o=l,h=c}}play(){this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,this.config.afterStart?.(),this.run())}stop(t){if(!(this.step===0||this.step===3)){if(!t&&t!==0){const e=this.prizes.map(i=>i.range);t=tt(e)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}}run(t=0){const{rAF:e,step:i,prizes:s,prizeFlag:n,_defaultConfig:r}=this,{accelerationTime:h,decelerationTime:o,speed:l}=r;if(i===0){this.endCallback?.(this.prizes.find((p,f)=>f===n)||{});return}if(n===-1)return;i===3&&!this.endIndex&&this.carveOnGunwaleOfAMovingBoat();const c=Date.now()-this.startTime,d=Date.now()-this.endTime;let g=this.currIndex;if(i===1||c<h){this.FPS=c/t;const p=O.easeIn(c,.1,l-.1,h);p===l&&(this.step=2),g=g+p%s.length}else i===2?(g=g+l%s.length,n!==void 0&&n>=0&&(this.step=3,this.stopIndex=0,this.endIndex=0)):i===3?(g=O.easeOut(d,this.stopIndex,this.endIndex,o),d>=o&&(this.step=0)):this.stop(-1);this.currIndex=g,this.draw(),e(this.run.bind(this,t+1))}getGeometricProperty([t,e,i=1,s=1]){const{cellWidth:n,cellHeight:r}=this,h=this._defaultConfig.gutter;let o=[this.prizeArea.x+(n+h)*t,this.prizeArea.y+(r+h)*e];return i&&s&&o.push(n*i+h*(i-1),r*s+h*(s-1)),o}conversionAxis(t,e){const{config:i}=this;return[t/i.dpr,e/i.dpr]}}class vt extends Y{constructor(t,e){super(t,{width:e.width,height:e.height}),this.blocks=[],this.prizes=[],this.slots=[],this.defaultConfig={},this._defaultConfig={},this.defaultStyle={},this._defaultStyle={},this.endCallback=()=>{},this.cellWidth=0,this.cellHeight=0,this.cellAndSpacing=0,this.widthAndSpacing=0,this.heightAndSpacing=0,this.FPS=16.6,this.scroll=[],this.stopScroll=[],this.endScroll=[],this.startTime=0,this.endTime=0,this.defaultOrder=[],this.step=0,this.prizeFlag=void 0,this.ImageCache=new Map,this.initData(e),this.initWatch(),this.initComputed(),t.beforeCreate?.call(this),this.init()}resize(){super.resize(),this.draw(),this.config.afterResize?.()}initLucky(){this.cellWidth=0,this.cellHeight=0,this.cellAndSpacing=0,this.widthAndSpacing=0,this.heightAndSpacing=0,this.FPS=16.6,this.scroll=[],this.stopScroll=[],this.endScroll=[],this.startTime=0,this.endTime=0,this.prizeFlag=void 0,this.step=0,super.initLucky()}initData(t){this.$set(this,"width",t.width),this.$set(this,"height",t.height),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"slots",t.slots||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"endCallback",t.end)}initComputed(){this.$computed(this,"_defaultConfig",()=>{const t={mode:"vertical",rowSpacing:0,colSpacing:5,speed:20,direction:1,accelerationTime:2500,decelerationTime:2500,...this.defaultConfig};return t.rowSpacing=this.getLength(t.rowSpacing),t.colSpacing=this.getLength(t.colSpacing),t}),this.$computed(this,"_defaultStyle",()=>({borderRadius:0,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%",...this.defaultStyle}))}initWatch(){this.$watch("width",t=>{this.data.width=t,this.resize()}),this.$watch("height",t=>{this.data.height=t,this.resize()}),this.$watch("blocks",t=>{this.initImageCache()},{deep:!0}),this.$watch("prizes",t=>{this.initImageCache()},{deep:!0}),this.$watch("slots",t=>{this.drawOffscreenCanvas(),this.draw()},{deep:!0}),this.$watch("defaultConfig",()=>this.draw(),{deep:!0}),this.$watch("defaultStyle",()=>this.draw(),{deep:!0}),this.$watch("endCallback",()=>this.init())}async init(){this.initLucky();const{config:t}=this;t.beforeInit?.call(this),this.drawOffscreenCanvas(),this.draw(),await this.initImageCache(),t.afterInit?.call(this)}initImageCache(){return new Promise(t=>{const e={blocks:this.blocks.map(i=>i.imgs),prizes:this.prizes.map(i=>i.imgs)};Object.keys(e).forEach(i=>{const s=e[i],n=[];s&&s.forEach((r,h)=>{r&&r.forEach((o,l)=>{n.push(this.loadAndCacheImg(i,h,l))})}),Promise.all(n).then(()=>{this.drawOffscreenCanvas(),this.draw(),t()})})})}async loadAndCacheImg(t,e,i){return new Promise((s,n)=>{let r=this[t][e];if(!r||!r.imgs)return;const h=r.imgs[i];h&&this.loadImg(h.src,h).then(async o=>{typeof h.formatter=="function"&&(o=await Promise.resolve(h.formatter.call(this,o))),this.ImageCache.set(h.src,o),s()}).catch(o=>{console.error(`${t}[${e}].imgs[${i}] ${o}`),n()})})}drawOffscreenCanvas(){const{_defaultConfig:t,_defaultStyle:e}=this,{w:i,h:s}=this.drawBlocks(),n=this.prizes.length,{cellWidth:r,cellHeight:h,widthAndSpacing:o,heightAndSpacing:l}=this.displacementWidthOrHeight();this.defaultOrder=new Array(n).fill(void 0).map((w,u)=>u);let c=0,d=0;this.slots.forEach((w,u)=>{this.scroll[u]===void 0&&(this.scroll[u]=0);const m=(w.order||this.defaultOrder).length;c=Math.max(c,i+o*m),d=Math.max(d,s+l*m)});const g=this.getOffscreenCanvas(c,d);if(!g)throw new Error("Failed to create offscreen canvas");const{_offscreenCanvas:p,_ctx:f}=g;this._offscreenCanvas=p,this.slots.forEach((w,u)=>{const b=r*u,m=h*u;let S=0;const y=ct(this.prizes,w.order||this.defaultOrder);if(!y.length)return;y.forEach((A,k)=>{if(!A)return;const M=o*k+t.colSpacing/2,B=l*k+t.rowSpacing/2,[D,q,Wt]=this.displacement([b,B,l],[M,m,o]);S+=Wt;const ht=A.background||e.background;if(I(ht)){const C=this.getLength(P(A,"borderRadius")?A.borderRadius:e.borderRadius);R(f,D,q,r,r,C),f.fillStyle=ht,f.fill()}A.imgs&&A.imgs.forEach((C,rt)=>{const F=this.ImageCache.get(C.src);if(!F)return;const[j,Z]=this.computedWidthAndHeight(F,C,r,h),[J,K]=[D+this.getOffsetX(j,r)+this.getLength(C.left,r),q+this.getLength(C.top,h)];this.drawImage(f,F,J,K,j,Z)}),A.fonts&&A.fonts.forEach(C=>{const rt=C.fontStyle||e.fontStyle,F=C.fontWeight||e.fontWeight,j=this.getLength(C.fontSize||e.fontSize),Z=C.lineHeight||e.lineHeight||C.fontSize||e.fontSize,J=P(C,"wordWrap")?C.wordWrap:e.wordWrap,K=C.lengthLimit||e.lengthLimit,kt=C.lineClamp||e.lineClamp;f.font=`${F} ${j>>0}px ${rt}`,f.fillStyle=C.fontColor||e.fontColor;let Q=[],ot=String(C.text);if(J){let X=this.getLength(K,r);Q=N(f,U(ot),()=>X,kt)}else Q=ot.split(`
`);Q.forEach((X,Lt)=>{f.fillText(X,D+this.getOffsetX(f.measureText(X).width,r)+this.getLength(C.left,r),q+this.getLength(C.top,h)+(Lt+1)*this.getLength(Z))})})});const[z,v,$,W]=this.displacement([b,0,r,S],[0,m,S,h]);let L=S;for(;L<d+S;){const[A,k]=this.displacement([z,L],[L,v]);this.drawImage(f,p,z,v,$,W,A,k,$,W),L+=S}})}drawBlocks(){const{config:t,ctx:e,_defaultConfig:i,_defaultStyle:s}=this;return this.prizeArea=this.blocks.reduce(({x:n,y:r,w:h,h:o},l,c)=>{const[d,g,p,f]=V(l,this.getLength.bind(this)),w=l.borderRadius?this.getLength(l.borderRadius):0,u=l.background||s.background;return I(u)&&(R(e,n,r,h,o,w),e.fillStyle=u,e.fill()),l.imgs&&l.imgs.forEach((b,m)=>{const S=this.ImageCache.get(b.src);if(!S)return;const[y,z]=this.computedWidthAndHeight(S,b,h,o),[v,$]=[this.getOffsetX(y,h)+this.getLength(b.left,h),this.getLength(b.top,o)];this.drawImage(e,S,n+v,r+$,y,z)}),{x:n+p,y:r+d,w:h-p-f,h:o-d-g}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight})}draw(){const{config:t,ctx:e,_defaultConfig:i,_defaultStyle:s}=this;t.beforeDraw?.call(this,e),e.clearRect(0,0,this.boxWidth,this.boxHeight);const{x:n,y:r,w:h,h:o}=this.drawBlocks();if(!this._offscreenCanvas)return;const{cellWidth:l,cellHeight:c,cellAndSpacing:d,widthAndSpacing:g,heightAndSpacing:p}=this;this.slots.forEach((f,w)=>{const u=f.order||this.defaultOrder,b=d*u.length,m=this.displacement(-(o-p)/2,-(h-g)/2);let S=this.scroll[w]+m;S<0&&(S=S%b+b),S>b&&(S=S%b);const[y,z,v,$]=this.displacement([l*w,S,l,o],[S,c*w,h,c]),[W,L,A,k]=this.displacement([n+g*w,r,l,o],[n,r+p*w,h,c]);this.drawImage(e,this._offscreenCanvas,y,z,v,$,W,L,A,k)})}carveOnGunwaleOfAMovingBoat(){const{_defaultConfig:t,prizeFlag:e,cellAndSpacing:i}=this;this.endTime=Date.now(),this.slots.forEach((s,n)=>{const r=s.order||this.defaultOrder;if(!r.length)return;const h=s.speed||t.speed,o=s.direction||t.direction,l=r.findIndex(p=>p===e[n]),c=i*r.length,d=this.stopScroll[n]=this.scroll[n];let g=0;for(;++g;){const p=i*l+c*g*o-d,f=O.easeOut(this.FPS,d,p,t.decelerationTime)-d;if(Math.abs(f)>h){this.endScroll[n]=p;break}}})}play(){this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,this.config.afterStart?.(),this.run())}stop(t){if(!(this.step===0||this.step===3)){if(typeof t=="number")this.prizeFlag=new Array(this.slots.length).fill(t);else if(T(t,"array"))if(t.length===this.slots.length)this.prizeFlag=t;else return this.stop(-1),console.error(`stop([${t}]) parameter length is incorrect`);else return this.stop(-1),console.error(`stop() cannot recognize parameter type ${typeof t}`);this.prizeFlag?.includes(-1)?(this.prizeFlag=[],this.step=0):this.step=2}}run(t=0){const{rAF:e,step:i,prizeFlag:s,_defaultConfig:n,cellAndSpacing:r,slots:h}=this,{accelerationTime:o,decelerationTime:l}=n;if(this.step===0&&s?.length===h.length){let g=s[0];for(let p=0;p<h.length;p++){const f=h[p],w=s[p];if(!(f.order||this.defaultOrder)?.includes(w)||g!==w){g=-1;break}}this.endCallback?.(this.prizes.find((p,f)=>f===g)||void 0);return}if(s!==void 0&&!s.length)return;this.step===3&&!this.endScroll.length&&this.carveOnGunwaleOfAMovingBoat();const c=Date.now()-this.startTime,d=Date.now()-this.endTime;h.forEach((g,p)=>{const f=g.order||this.defaultOrder;if(!f||!f.length)return;const w=r*f.length,u=Math.abs(g.speed||n.speed),b=g.direction||n.direction;let m=0,S=this.scroll[p];if(i===1||c<o){this.FPS=c/t;const y=O.easeIn(c,0,u,o);y===u&&(this.step=2),m=(S+y*b)%w}else if(i===2)m=(S+u*b)%w,s?.length===h.length&&(this.step=3,this.stopScroll=[],this.endScroll=[]);else if(i===3&&d){const y=this.stopScroll[p],z=this.endScroll[p];m=O.easeOut(d,y,z,l),d>=l&&(this.step=0)}this.scroll[p]=m}),this.draw(),e(this.run.bind(this,t+1))}displacement(t,e){return this._defaultConfig.mode==="horizontal"?e:t}displacementWidthOrHeight(){const t=this._defaultConfig.mode,e=this.slots.length,{colSpacing:i,rowSpacing:s}=this._defaultConfig,{x:n,y:r,w:h,h:o}=this.prizeArea||this.drawBlocks();let l=0,c=0,d=0,g=0;return t==="horizontal"?(c=this.cellHeight=(o-s*(e-1))/e,l=this.cellWidth=c):(l=this.cellWidth=(h-i*(e-1))/e,c=this.cellHeight=l),d=this.widthAndSpacing=this.cellWidth+i,g=this.heightAndSpacing=this.cellHeight+s,t==="horizontal"?this.cellAndSpacing=d:this.cellAndSpacing=g,{cellWidth:l,cellHeight:c,widthAndSpacing:d,heightAndSpacing:g}}}const At=(a,t)=>{const e=document.createElement("canvas"),i=e.getContext("2d"),{width:s,height:n}=a;return e.width=s,e.height=n,R(i,0,0,s,n,t),i.clip(),i.drawImage(a,0,0,s,n),e},$t=(a,t)=>{const e=document.createElement("canvas"),i=e.getContext("2d"),{width:s,height:n}=a;if(e.width=s,e.height=n,typeof i.filter=="string")i.filter=`opacity(${t*100}%)`,i.drawImage(a,0,0,s,n);else{i.drawImage(a,0,0,s,n);const r=i.getImageData(0,0,s,n),{data:h}=r,o=h.length;for(let l=0;l<o;l+=4){const c=h[l+3];c!==0&&(h[l+3]=c*t)}i.putImageData(r,0,0)}return e};x.LuckyGrid=zt,x.LuckyWheel=Ct,x.SlotMachine=vt,x.cutRound=At,x.opacity=$t,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
